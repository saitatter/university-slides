<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Laborator 08 – Iluminare Phong</title>

    <!-- Reveal.js core -->
    <link rel="stylesheet" href="https://unpkg.com/reveal.js/dist/reveal.css" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/reveal.js/dist/theme/black.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/highlight.js@11.9.0/styles/monokai.min.css"
    />

    <style>
      .back-home {
        position: fixed;
        bottom: 14px; /* jos */
        left: 16px; /* stânga */
        padding: 6px 10px;
        font-size: 12px;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        color: #fff;
        text-decoration: none;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.35);
        background: rgba(0, 0, 0, 0.45);
        backdrop-filter: blur(6px);
        z-index: 9999;
        transition: background 0.15s ease, transform 0.1s ease,
          border-color 0.15s ease;
      }

      .back-home:hover {
        background: rgba(255, 255, 255, 0.12);
        border-color: rgba(255, 255, 255, 0.7);
        transform: translateY(-1px);
      }
      body {
        font-family: monospace;
      }
      code {
        background: none;
        padding: 0;
        border-radius: 0;
      }
      .reveal pre {
        background: none !important;
        box-shadow: none !important;
      }

      .reveal pre code {
        background: none !important;
      }
      #p5-container {
        width: 600px;
        height: 400px;
        margin: auto;
        border: 1px solid #fff;
      }
      h1,
      h2 {
        margin: 0.5em 0;
      }
      p {
        margin: 0.3em 0;
      }
      body {
        font-family: monospace;
      }
      #p5-spotlight {
        width: 600px;
        height: 400px;
        margin: auto;
      }
    </style>
  </head>
  <body>
    <a href="../../index.html" class="back-home">← Înapoi la prezentări</a>

    <div class="reveal">
      <div class="slides">
        <!-- Slide 1 -->
        <section>
          <h1>Modelarea reflexiei luminii</h1>
          <p>Laborator 08 – Iluminare Phong, Spot-light, Multiple Lights</p>
        </section>

        <!-- Slide 2 -->
        <section>
          <h2>Componentele modelului</h2>
          <p><code>C = Ce + Ca + Cd + Cs</code></p>
          <ul>
            <li>Ce – componenta emisivă</li>
            <li>Ca – componenta ambientală</li>
            <li>Cd – componenta difuză</li>
            <li>Cs – componenta speculară</li>
          </ul>
        </section>

        <!-- Slide 3 -->
        <section>
          <h2>Formula completă</h2>
          \[ C = K_e + I_a K_a + \sum_i \left[ f_{a_i} I_{s_i} \left( K_d \max(N
          \cdot L_i, 0) + K_s \, \text{lum}_i \left( \max(N \cdot H_i, 0)^n
          \right) \right) \right] \]
          <ul>
            <li>Ia, Is_i – intensități RGB</li>
            <li>Ke, Ka, Kd, Ks – materiale (RGB)</li>
            <li>fa_i – atenuare</li>
          </ul>
        </section>

        <!-- Slide 4 -->
        <section>
          <h2>Simplificări laborator anterior</h2>
          <ul>
            <li class="fragment fade-up">Materiale float, nu vec3</li>
            <li class="fragment fade-up">Isursă = 1</li>
            <li class="fragment fade-up">Culoare emisă ignorată</li>
            <li class="fragment fade-up">Ka înlocuit cu Kd</li>
            <li class="fragment fade-up">Ambient = 0.25</li>
            <li class="fragment fade-up">Calcul pe un singur canal</li>
          </ul>
        </section>

        <!-- Slide 5 -->
        <section>
          <h2>Iluminare în Fragment Shader</h2>
          <ul>
            <li>Calcul pe fragment → calitate mai bună</li>
            <li>Muchii netede, fără artefacte</li>
            <li>Lumină interpolată corect</li>
          </ul>
        </section>

        <!-- Slide 6 -->
        <!-- Grup vertical: Interpolare în GLSL -->
        <section>
          <!-- Slide 1 (sus) – explicații -->
          <section>
            <h2>Interpolare în GLSL</h2>
            <ul>
              <li>
                <code>flat</code> – fără interpolare: fragmentul ia valoarea
                dintr-un singur vârf (ex: ultimul)
              </li>
              <li>
                <code>smooth</code> – interpolare perspectivă (implicit), ține
                cont de adâncime (1/z)
              </li>
              <li>
                <code>noperspective</code> – interpolare liniară în spațiul
                ecran (fără corecție de perspectivă)
              </li>
            </ul>

            <p style="font-size: 0.8em; margin-top: 1em">În OpenGL core:</p>
            <pre><code class="language-glsl">
flat          out vec3 vColorFlat;
smooth        out vec3 vColorSmooth;      // implicit
noperspective out vec3 vColorNoPersp;
    </code></pre>

            <p style="font-size: 0.8em; margin-top: 1em">
              În WebGL / p5.js nu avem calificativele astea direct, dar putem
              simula:
              <br />- <code>flat</code> → o singură culoare pe tot triunghiul
              <br />- <code>noperspective</code> → barycentrice direct în ecran
              <br />- <code>smooth</code> → barycentrice cu corecție de
              perspectivă (1/z)
            </p>
          </section>

          <!-- Slide 2 (jos) – demo p5.js -->
          <section>
            <h2>Interpolare – Demo (flat / noperspective / smooth)</h2>
            <div
              id="p5-interpolation"
              style="width: 900px; height: 300px"
            ></div>

            <p style="font-size: 0.7em; margin-top: 0.5em">
              Stânga: <code>flat</code> – aceeași culoare pe tot triunghiul<br />
              Mijloc: <code>noperspective</code> – interpolare liniară în
              spațiul ecran<br />
              Dreapta: <code>smooth</code> – interpolare corectată în
              perspectivă (1/z)
            </p>
          </section>
        </section>
        <!-- Slide 7 -->
        <!-- Vertical group: Spot-light -->
        <section>
          <!-- Top slide: explanation -->
          <section>
            <h2>Spot-light</h2>
            <pre><code class="language-glsl">
spot = dot(-L, light_dir);
if (spot > cos(cutoff)) {
    // punct iluminat
}
    </code></pre>
            <ul>
              <li>
                <code>L</code> – vector de la fragment spre sursa de lumină
              </li>
              <li><code>light_dir</code> – direcția axei spot-light-ului</li>
              <li><code>cutoff</code> – unghiul limită al conului</li>
              <li>
                <code>spot = dot(-L, light_dir)</code> ≈ cosinusul unghiului
                dintre ele
              </li>
              <li>
                <code>spot &gt; cos(cutoff)</code> → fragmentul este în
                interiorul conului
              </li>
            </ul>
          </section>

          <!-- Bottom slide: 2D schematic demo -->
          <section>
            <h2>Spot-light – Demo 2D (schematic)</h2>
            <div
              id="p5-spotlight-2d"
              style="width: 600px; height: 400px; margin: 0 auto"
            ></div>
            <p style="font-size: 0.7em; margin-top: 0.5em">
              Mouse = punct de test<br />
              Verde = în interiorul conului (<code
                >dot(-L, light_dir) &gt; cos(cutoff)</code
              >)<br />
              Gri = în afara conului
            </p>
          </section>
        </section>

        <!-- Slide 8 -->
        <section>
          <h2>Atenuare unghiulară</h2>
          <pre>
linear_att = (spot - limit) / (1 - limit)
att = linear_att^2
      </pre
          >
        </section>

        <!-- Slide 9 -->
        <section>
          <h2>Multiple Lights</h2>
          <p>Vectori uniforme:</p>
          <pre>
uniform vec3 point_light_pos[9];
uniform vec3 point_light_color[9];
      </pre
          >
          <p>Structuri:</p>
          <pre><code class="language-cpp">
struct light_source {
  int type;
  vec3 position;
  vec3 color;
  vec3 direction;
};
</code></pre>
        </section>

        <!-- Slide 10 -->
        <section>
          <h2>Funcții GLSL</h2>
          <pre>
vec3 point_light_contribution(vec3 pos, vec3 color);
      </pre
          >
          <p>
            Parametri: <code>in</code>, <code>out</code>, <code>inout</code>
          </p>
        </section>

        <!-- Slide 11 -->
        <section>
          <h2>Cerințe laborator</h2>
          <ul>
            <li>Implementare Phong în Fragment Shader</li>
            <li>Tasta <code>F</code> → Spot-light</li>
            <li>Atenuare lumini</li>
            <li>Adăugare sursă suplimentară</li>
            <li>F5 → reîncărcare shadere</li>
          </ul>
        </section>

        <!-- Slide 12 -->
        <section>
          <h2>Spot-light – Outer vs Inner Cutoff</h2>
          <div
            style="
              display: flex;
              gap: 40px;
              justify-content: center;
              align-items: center;
              height: 420px;
            "
          >
            <div id="p5-spotlight-outer" style="width: 600px"></div>
            <div id="p5-spotlight-inner" style="width: 600px"></div>
          </div>
        </section>
      </div>
    </div>

    <!-- Reveal.js -->
    <script src="https://unpkg.com/reveal.js/dist/reveal.js"></script>
    <script src="https://unpkg.com/reveal.js/plugin/highlight/highlight.js"></script>
    <script src="https://unpkg.com/reveal.js/plugin/math/math.js"></script>

    <!-- p5.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
    <script src="js/spotlight-demo.js"></script>
    <script src="js/interpolation-demo.js"></script>
    <script src="js/spotlight2d-demo.js"></script>

    <script>
      Reveal.initialize({
        hash: true,
        plugins: [RevealHighlight, RevealMath.KaTeX],
      });

      function maybeStartP5Demos(event) {
        const slide = event.currentSlide;

        if (slide.querySelector("#p5-spotlight-outer")) {
          createSpotlightDemo("p5-spotlight-outer", false);
          createSpotlightDemo("p5-spotlight-inner", true);
          Reveal.layout(); // recalculăm layout-ul după ce apare canvas-ul
        }

        if (slide.querySelector("#p5-interpolation")) {
          startInterpolationDemo();
          Reveal.layout();
        }

        if (slide.querySelector("#p5-spotlight-2d")) {
          startSpotlight2DDemo();
          Reveal.layout();
        }
      }

      Reveal.on("ready", maybeStartP5Demos);
      Reveal.on("slidechanged", maybeStartP5Demos);
    </script>
  </body>
</html>
